PROJECT(libsquash C)
CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

OPTION(BUILD_TESTS "Build a test of libsquash" OFF)

FIND_PACKAGE(ZLIB REQUIRED)
INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIRS})

INCLUDE_DIRECTORIES(src include)
FILE(GLOB SRC_H include/squash.h include/squash/*.h)
FILE(GLOB SRC_SQUASH src/*.c)
ADD_LIBRARY(squash ${SRC_H} ${SRC_SQUASH})

IF(BUILD_TESTS)
  ENABLE_TESTING()
  ADD_TEST(squash_tests squash_tests)
  FILE(GLOB SRC_TEST tests/*.c)
  ADD_EXECUTABLE(squash_tests ${SRC_TEST})
  TARGET_LINK_LIBRARIES(squash_tests squash ${ZLIB_LIBRARIES})
ENDIF()
