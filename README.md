# Libsquash

User-land SquashFS that can be linked and embedded within your application.

[![Build status: Linux and Darwin](https://travis-ci.org/enclose-io/libsquash.svg?branch=master)](https://travis-ci.org/enclose-io/libsquash)
[![Build status: Windows](https://ci.appveyor.com/api/projects/status/idimki81u783uab0?svg=true)](https://ci.appveyor.com/project/pmq20/libsquash)
[![Coverity Scan](https://scan.coverity.com/projects/11025/badge.svg)](https://scan.coverity.com/projects/pmq20-libsquash)

## Building

On most systems you could build and test the library using the following commands,

    mkdir build
    cd build
    cmake ..
    cmake --build .
    ctest

## API

### `squash_opendisk(data, data_size)`

Creates a new `squash_disk_t` instance by reading from `data`, which is of length `data_size`.
`data` should point to a `const uint8_t` array holding the binary content of the SquashFS file,
which could be generated by an independently installed `mksquashfs` tool and loaded into the memory in advance.
The returned resource should later be freed by `squash_closedisk`.

### `squash_closedisk(disk)`

Frees the memory allocated for `disk`.
Note that the original referenced SquashFS data when creating `disk` will not be freed.

### `squash_opendir(disk, filename)`

Opens the directory named by `filename` of the SquashFS `disk`,
associates a directory stream with it and returns a pointer
to be used to identify the directory stream in subsequent operations.
The pointer `NULL` is returned if `filename` cannot be accessed,
or if it cannot allocate enough memory to hold the whole thing.
The returned resource should later be freed by `squash_closedir`.

### `squash_closedir(dirp)`

Closes the named directory stream and frees the structure associated with the `dirp` pointer,
returning `0` on success.  On failure, `-1` is returned.

### `squash_readdir(dirp)`

Returns a pointer to the next directory entry.
It returns `NULL` upon reaching the end of the directory or on error. 

### `squash_chdir(disk, path)`

Causes the named directory to become the current working directory of the SquashFS `disk`,
that is, the starting point for path searches of pathnames not beginning with a slash, `/`.
Upon successful completion, a value of `0` is returned. Otherwise, a value of `-1` is returned.

### `squash_getcwd(disk, buf, size)`

Copies the absolute pathname of the current working directory of the SquashFS `disk`
into the memory referenced by `buf` and returns a pointer to `buf`.
The `size` argument is the size, in bytes, of the array referenced by `buf`.
If `buf` is `NULL`, space is allocated as necessary to store the pathname.
This space may later be `free`'d.

### `squash_chroot(disk, dirname)`

Causes `dirname` to become the root directory of the SquashFS `disk`,
that is, the starting point for path searches of pathnames beginning with `/`.


## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/enclose-io/libsquash.

## Contributors

* [pmq20](https://github.com/pmq20) - **Minqi Pan** &lt;pmq2001@gmail.com&gt;

## License

Copyright (c) 2016 Libsquash contributers, under terms of the [MIT License](http://opensource.org/licenses/MIT).
